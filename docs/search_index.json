[["neighbour-crowding-effect-on-neutral-and-adaptive-genetic-variation.html", "Chapter 6 Neighbour crowding effect on neutral and adaptive genetic variation 6.1 Simulated animal 6.2 Neighbour crowding index 6.3 Genetic variance", " Chapter 6 Neighbour crowding effect on neutral and adaptive genetic variation We did environmental association analyses (Rellstab et al. 2015) in each complex using general linear mixed models developed for genome wide association studies (GWAS). We used mean neighbourhood crowding index (\\(NCI\\); Uriarte et al. 2004) over the last 30 years, an indirect measurement of access to light and forest gap dynamics, as the response variable and genetic structure (gene pools representing species) and relatedness (kinship matrix) as explanatory variables, as it is common practice (Rellstab et al. 2015). This analysis assumed that the neighbour crowding conditions where individuals have grown above 10-cm DBH are strongly correlated to the individual heritable phenotypes (e.g. Eckert et al. 2010). The mean neighborhood crowding index \\(NCI_i\\) from tree individual \\(i\\) was calculated as follow: \\[NCI_i=\\overline{\\sum_{j|\\delta_{i,j}&lt;20m}DBH^2_{j,t}.e^{-\\frac14\\delta_{i,j}}}\\] with \\(DBH_{j,t}\\) the diameter of the neighbouring tree \\(j\\) in year \\(t\\) and \\(\\delta_{i,j}\\) its distance to the individual tree \\(i\\). \\(NCI_i\\) is computed for all neighbours at a distance \\(\\delta_{i,j}\\) inferior to the maximum neighbouring distance of 20 meters. The power of neighbours \\(DBH_{j,t}\\) effect was set to 2 to represent a surface. The decrease of neighbours diameter effect with distance was set to -0.25 to represent trees at 20 meters of the focal trees having 1% of the effect of the same tree at 0 meters. \\(NCI_i\\) is computed as the mean of yearly \\(NCI_{i,t}\\) over the last 30 years denoted by the overline. We used genetic species and individual kinship in an animal model (Wilson et al. 2010) to estimate genetic variance associated with neighbour crowding index. We used a lognormal likelihood given that distributions of environmental variables were positive and skewed. We inferred individual kinship using KING (Manichaikul et al. 2010), as the method is robust to population structure. We set negative kinship values to null as they were confounding with population structure, and we further ensured that the matrix was positive-definite using the nearPD function from the R package Matrix. The environment \\(y_{s,i}\\) where individual \\(i\\) in species \\(s\\) grows was inferred with a lognormal distribution with the following formula: \\[y_{s,i} \\sim logN(log(\\mu_s.a_{i}),\\sigma^2_1)\\] \\[a_{i} \\sim MVlogN_N(log(1),\\sigma^2_2.K)\\] where \\(\\mu_s\\) is the mean environment of species \\(s\\), \\(a_i\\) is the breeding value of the individual \\(i\\) and \\(\\sigma^2_1\\) is the shape parameter of the lognormal. Individual breeding values \\(a_i\\) are defined following a multivariate lognormal law \\(\\mathcal{MVlogN}\\) of co-shape matrix defined as the product of the kinship matrix \\(K\\) with estimated individual genotypic variation \\(\\sigma^2_2\\). To estimate variances on a normal scale, we log-transformed species fixed effect, genetic additive values, and we calculated conditional and marginal \\(R^2\\) (Nakagawa &amp; Schielzeth 2013). A Bayesian method was used to infer parameters using stan language [Carpenter et al. (2017) and rstan package (Stan Development Team 2018) in the R environment (R Core Team 2020) using the No-U-Turn Sampler alogirthm (NUTS, Hoffman &amp; Gelman 2014), which performs better for estimating genetic parameters and breeding values (Nishio &amp; Arakawa 2019). 6.1 Simulated animal The aim of this sub-chapter is to explore animal model with generated data to validate their behavior and use it on Symphonia real data. Let’s consider a set of \\(P=3\\) populations including each \\(Fam=3\\) families composed of \\(I = 14\\) individuals with arbitrary relationships (it’s only 126 individuals to do quick tests). Figure 6.1: Kinship matrix We used the following animal model with a lognormal distribution to estimate population and genotypic variance: \\[\\begin{equation} y_{p,i} \\sim \\mathcal{logN}(log(\\mu_p.a_{i}),\\sigma_1) \\\\ a_{p,i} \\sim \\mathcal{MVlogN_N}(log(1),\\sigma_2.K) \\tag{6.1} \\end{equation}\\] We fitted the equivalent model with following priors: \\[\\begin{equation} y_{p,i} \\sim \\mathcal{logN}(log(\\mu_p.\\hat{a_{i}}), \\sigma_1) \\\\ \\hat{a_{i}} = e^{\\sqrt{V_G}.A.\\epsilon_i} \\\\ \\epsilon_i \\sim \\mathcal{N}(0,1) \\\\ ~ \\\\ \\mu_p \\sim \\mathcal{logN}(log(1),1) \\\\ \\sigma_1 \\sim \\mathcal N_T(0,1) \\\\ ~ \\\\ V_Y = Var(log(y)) \\\\ V_P = Var(log(\\mu_p)) \\\\ V_R=\\sigma_1^2 \\\\ V_G = V_Y - V_P - V_R \\\\ \\tag{6.2} \\end{equation}\\] Table 6.1: Animal model fitted versus expected values. Parameter Estimate Expected Standard error \\(\\hat R\\) mu[1] 0.7484767 0.7357714 0.0535640 1.0054690 mu[2] 0.3968538 0.3633681 0.0308554 1.0010121 mu[3] 0.5184509 0.5420625 0.0469693 1.0023625 Vp 0.0711053 0.0841187 0.0151127 1.0011662 Vg 0.0772814 0.0837454 0.0223466 1.0014673 Vr 0.0385718 0.0400000 0.0145103 0.9997977 Figure 6.2: Parameters for Animal model traceplot and expected value in red. 6.2 Neighbour crowding index trees &lt;- src_sqlite(file.path(&quot;data&quot;, &quot;Paracou&quot;,&quot;trees&quot;, &quot;Paracou.sqlite&quot;)) %&gt;% tbl(&quot;Paracou&quot;) %&gt;% filter(Genus == &quot;Symphonia&quot;) %&gt;% filter(CensusYear == 2015) %&gt;% collect() trees &lt;- read_tsv(file.path(path, &quot;..&quot;, &quot;variantCalling&quot;, &quot;paracou3pop&quot;, &quot;symcapture.all.biallelic.snp.filtered.nonmissing.paracou3pop.fam&quot;), col_names = c(&quot;FID&quot;, &quot;IID&quot;, &quot;FIID&quot;, &quot;MIID&quot;, &quot;sex&quot;, &quot;phenotype&quot;)) %&gt;% mutate(Ind = gsub(&quot;.g.vcf&quot;, &quot;&quot;, IID)) %&gt;% mutate(X = gsub(&quot;P&quot;, &quot;&quot;, Ind)) %&gt;% separate(X, c(&quot;Plot&quot;, &quot;SubPlot&quot;, &quot;TreeFieldNum&quot;), convert = T) %&gt;% left_join(trees) %&gt;% left_join(read_tsv(file.path(path, &quot;bayescenv&quot;, &quot;paracou3pop.popmap&quot;), col_names = c(&quot;IID&quot;, &quot;pop&quot;))) cl &lt;- parallel::makeCluster(getOption(&quot;cl.cores&quot;, 4)) parallel::clusterExport(cl, list(&quot;trees&quot;)) NC &lt;- parallel::parLapply(cl, 1:nrow(trees), function(ind){ library(tidyverse) src_sqlite(file.path(&quot;data&quot;, &quot;Paracou&quot;, &quot;trees&quot;, &quot;Paracou.sqlite&quot;)) %&gt;% tbl(&quot;Paracou&quot;) %&gt;% filter(Plot == local(trees$Plot[ind])) %&gt;% filter(idTree != local(trees$idTree[ind])) %&gt;% mutate(dij = sqrt((local(trees$Xutm[ind]) - Xutm)^2+(local(trees$Yutm[ind]) - Yutm)^2)) %&gt;% filter(dij &lt; 20) %&gt;% mutate(con = ifelse(Genus == local(trees$Genus[ind]) &amp;&amp; Species == local(trees$Species[ind]), 1, 0)) %&gt;% mutate(DBH = CircCorr/pi) %&gt;% collect() %&gt;% group_by(CensusYear) %&gt;% summarise(NCI = sum(DBH*DBH*exp(-0.25*dij))) %&gt;% ungroup() %&gt;% summarise(idTree = local(trees$idTree[ind]), NCI = mean(NCI))}) parallel::stopCluster(cl) ; rm(cl) NC &lt;- bind_rows(NC) trees &lt;- left_join(trees, NC) %&gt;% dplyr::select(IID, Ind, pop, NCI) rm(NC) write_tsv(trees, file = &quot;save/NCI.tsv&quot;) 6.3 Genetic variance We used between individual kinship and a lognormal Animal model (Wilson et al. 2010) to estimate genetic variance associated to individuals global phenotype leaving in a given environment (see environmental association analyses with genome wide assocaition study analyses in Rellstab et al. 2015). Animal model is calculated for the environmental values \\(y\\) of the \\(N\\) individuals with following formula: \\[\\begin{equation} y_{p,i} \\sim \\mathcal{logN}(log(a_{p,i}),\\sigma_1) \\\\ a_{p,i} \\sim \\mathcal{MVlogN_N}(log(\\mu_p),\\sigma_2.K) \\tag{6.3} \\end{equation}\\] where individual is defined as a normal law centered on the individual genetic additive effects \\(a\\) and associated individual remaining variance \\(\\sigma_R\\). Additive genetic variance \\(a\\) follow a multivariate lognormal law centered on the population mean \\(\\mu_{Population}\\) of covariance \\(\\sigma_G K\\). We fitted the equivalent model with following priors: \\[\\begin{equation} y_{p,i} \\sim \\mathcal{logN}(log(\\mu_p) + \\hat{\\sigma_2}.A.\\epsilon_i, \\sigma_1) \\\\ \\epsilon_i \\sim \\mathcal{N}(0,1) \\\\ ~ \\\\ \\mu_p \\sim \\mathcal{logN}(log(1),1) \\\\ \\sigma_1 \\sim \\mathcal N_T(0,1) \\\\ \\hat{\\sigma_2} = \\sqrt(V_G) ~ \\\\ V_Y = Var(log(y)) \\\\ V_P = Var(log(\\mu_p)) \\\\ V_G = V_Y - V_P - V_R \\\\ V_R=\\sigma_1^2 \\tag{6.4} \\end{equation}\\] Table 6.2: Summary table of the kinship growth model Variable Parameter Population Estimate \\(\\sigma\\) \\(\\hat{R}\\) NCI mu S. globulifera Paracou 0.7880048 0.0305778 0.9997771 NCI mu S. globulifera Regina 0.9443492 0.0643210 1.0003822 NCI mu S. sp1 0.9426952 0.0290419 1.0012267 NCI Vp 0.0071862 0.0033377 1.0004033 NCI Vg 0.0210950 0.0193455 1.0640539 NCI Vr 0.0922548 0.0193773 1.0615180 Figure 6.3: Traceplot for environmental variables. Figure 6.4: R2 for environmental variable Figure 6.5: Genetic variance partitionning for environmental variables. References "]]
